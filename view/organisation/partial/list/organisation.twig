<h1 id="title">
    {{ translate("txt-organisation-list") }}
    <div id="throbber"></div>
</h1>

<div class="row">
    <div class="col-sm-6">
        <p class="lead">{{ translate("txt-organisation-list-explanation") }}</p>
    </div>

    <div class="col-sm-6">

        <form class="form" id="organisationSearch">
            <div class="input-group">
                <input type="text" class="form-control" id="search" name="q"
                       placeholder="{{ translate("txt-search-item") }}">
                <span class="input-group-btn">
        <input type="submit" value="{{ translate("txt-search") }}" class="btn btn-primary">
                        </span>
            </div>
        </form>
    </div>


</div>

<div id="organisation-list">
    {% if paginator.pageRange > 0 %}
        <table class="table table-condensed table-sm table-striped table-hover">
            <thead>
            <tr>
                <th>{{ translate("txt-organisation") }}</th>
                <th>{{ translate("txt-country") }}</th>
                <th>{{ translate("txt-type") }}</th>
            </tr>
            </thead>
            <tbody>
            {% for organisation in paginator.getCurrentItems() %}
                <tr>
                    <td>{{ organisationLink(organisation,'view','name') }}</td>
                    <td>{{ countryLink(organisation.country,'view','name') }}</td>
                    <td>{{ organisation.type }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% include 'organisation/partial/pagination-control' with {'paginator': paginator} %}
    {% endif %}
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var timeoutID = null;

        function findOrganisation() {
            $.ajax({
                url: 'organisation/search',
                data: {
                    max_rows: 2000,
                    search_item: $("#search").val()
                },
                success: function (data) {
                    $("#organisation-list").html(data);
                },
                error: function (event, ui) {
                    alert("Search Failed");
                }
            });
        }


        $("#organisationSearch").on('submit', function (e) {
                e.preventDefault();
                findOrganisation();
            }
        );

        $("#search").on('keyup', function (e) {
                clearTimeout(timeoutID);
                timeoutID = setTimeout(findOrganisation(), 500);
            }
        );
    });
</script>
